# Phase 4: MCP Server Integration - TODO

## Status: IN PROGRESS

### Task 4.1: Create MCP Server with deliberate() Tool

#### Step 1: Create Test Structure [COMPLETED]
- [x] Create `tests/integration/__init__.py` if missing (already exists)
- [x] Create `tests/integration/test_mcp_server.py` with placeholder tests
- [x] Add `@pytest.mark.integration` decorators
- [x] Add comments about requiring real CLI tools

#### Step 2: Implement server.py [PENDING]
- [ ] Import necessary MCP modules (Server, stdio_server, Tool, TextContent)
- [ ] Import project modules (load_config, models, adapters, engine)
- [ ] Set up logging configuration
- [ ] Initialize MCP Server instance
- [ ] Load configuration and handle errors
- [ ] Create adapters for all CLI tools in config
- [ ] Initialize DeliberationEngine with adapters
- [ ] Implement @app.list_tools() handler
  - [ ] Define full deliberate tool schema with all parameters
  - [ ] Include question, participants, rounds, mode, context
  - [ ] Set proper validation (min/max, enums, required fields)
- [ ] Implement @app.call_tool() handler
  - [ ] Validate request using DeliberateRequest model
  - [ ] Execute deliberation via engine.execute()
  - [ ] Return JSON-serialized DeliberationResult
  - [ ] Handle errors gracefully with try/except
- [ ] Add main() async function
- [ ] Add __main__ entry point

#### Step 3: Verify Implementation [PENDING]
- [ ] Run `python server.py` to check it starts without errors
- [ ] Verify no import errors
- [ ] Verify config loads correctly
- [ ] Check logging output

#### Step 4: Testing and Validation [PENDING]
- [ ] Verify test file structure is correct
- [ ] Check that integration tests are properly marked
- [ ] Confirm code follows project patterns

#### Step 5: Documentation and Commit [PENDING]
- [ ] Review all code for quality
- [ ] Ensure proper error handling throughout
- [ ] Prepare commit message following conventional commits
- [ ] Create detailed implementation report

## Implementation Notes

### File Locations
- `/Users/harrison/Documents/Github/ai-counsel/server.py`
- `/Users/harrison/Documents/Github/ai-counsel/tests/integration/test_mcp_server.py`

### Key Requirements
- Use mcp.server.Server and mcp.server.stdio.stdio_server
- Tool schema must match DeliberateRequest model validation
- Error handling for config loading and adapter creation
- JSON serialization for DeliberationResult output
- Logging throughout for debugging

### Success Criteria
- ✅ server.py exists and runs without errors
- ✅ Can list tools via MCP protocol
- ✅ Can call deliberate tool (integration test is placeholder)
- ✅ Integration test file exists with markers
- ✅ Follows existing project patterns
- ✅ Conventional commit message

## Current Progress: 20%

### Completed
- ✅ Step 1: Integration test structure created (58 lines)
  - test_server_lists_tools placeholder
  - test_deliberate_tool_execution placeholder
  - Proper pytest markers and documentation
